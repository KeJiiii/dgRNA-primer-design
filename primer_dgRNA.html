<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§¬ gRNAå¼•ç‰©è®¾è®¡å™¨</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 30px;
        }
        
        /* é€‰é¡¹å¡æ ·å¼ */
        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
        }
        
        .tab {
            padding: 15px 30px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: #4CAF50;
        }
        
        .tab.active {
            color: #4CAF50;
            border-bottom-color: #4CAF50;
            background: #f0f9f0;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* å•å¯¹è®¾è®¡æ ·å¼ */
        .input-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .input-section {
                grid-template-columns: 1fr;
            }
        }
        
        /* æ‰¹é‡è®¾è®¡æ ·å¼ */
        .batch-section {
            margin-bottom: 30px;
        }
        
        .batch-input {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            resize: vertical;
            margin-bottom: 20px;
        }
        
        .batch-input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .batch-example {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #666;
        }
        
        /* ç»“æœè¡¨æ ¼æ ·å¼ */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .results-table th {
            background: #4CAF50;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .results-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .results-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .results-table tr:hover {
            background: #e8f5e8;
        }
        
        .seq-cell {
            font-family: 'Courier New', monospace;
            word-break: break-all;
            max-width: 300px;
        }
        
        /* é€šç”¨æ ·å¼ */
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 1.1em;
        }
        
        input[type="text"] {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.1em;
            font-family: 'Courier New', monospace;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .seq-info {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }
        
        .info-badge {
            background: #f0f9ff;
            padding: 5px 10px;
            border-radius: 15px;
            border: 1px solid #d1ecf1;
        }
        
        .info-badge.warning {
            background: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }
        
        .design-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            margin: 10px 0;
        }
        
        .design-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .design-btn:active {
            transform: translateY(0);
        }
        
        .design-btn.full-width {
            width: 100%;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }
        
        .result-section {
            margin-top: 30px;
        }
        
        .success-msg {
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #c3e6cb;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2em;
            font-weight: 600;
        }
        
        .primers-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .primers-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .primer-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }
        
        .primer-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .primer-title.forward { color: #3498db; }
        .primer-title.reverse { color: #e74c3c; }
        
        .primer-title h3 {
            font-size: 1.3em;
        }
        
        .icon {
            font-size: 1.5em;
        }
        
        .sequence-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px dashed #dee2e6;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            word-break: break-all;
            line-height: 1.8;
            margin-bottom: 15px;
        }
        
        .properties {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .property {
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #dee2e6;
            font-size: 0.9em;
        }
        
        .property.highlight {
            background: #e3f2fd;
            border-color: #bbdefb;
            color: #1565c0;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            border-top: 1px solid #eee;
            font-size: 0.9em;
        }
        
        .dna-helix {
            font-size: 2em;
            letter-spacing: 5px;
            margin: 10px 0;
            color: #4CAF50;
        }
        
        .instructions {
            background: #f0f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
        }
        
        .instructions h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .export-options {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .export-btn {
            padding: 10px 20px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .export-btn:hover {
            background: #545b62;
        }
        
        .export-btn.csv { background: #28a745; }
        .export-btn.csv:hover { background: #1e7e34; }
        
        .export-btn.fasta { background: #17a2b8; }
        .export-btn.fasta:hover { background: #117a8b; }
        
        .export-btn.excel { background: #20c997; }
        .export-btn.excel:hover { background: #1a9367; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="dna-helix">ğŸ§¬</div>
            <h1>gRNAå¼•ç‰©è®¾è®¡å™¨</h1>
            <p class="subtitle">AAV CAG FlexNLSCherry2x U6gRNA ä¸€æ­¥æ³•åŒgRNAæ„å»º</p>
        </header>
        
        <div class="main-content">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('single')">å•å¯¹è®¾è®¡</div>
                <div class="tab" onclick="switchTab('batch')">æ‰¹é‡è®¾è®¡</div>
                <div class="tab" onclick="switchTab('plasmid')">è´¨ç²’æ„å»ºæµç¨‹</div>
                
            </div>
            
            <!-- å•å¯¹è®¾è®¡é€‰é¡¹å¡ -->
            <div id="tab-single" class="tab-content active">
                <div class="instructions">
                    <h3>ä½¿ç”¨è¯´æ˜ï¼š</h3>
                    <ul>
                        <li>è¾“å…¥gRNA1å’ŒgRNA2çš„DNAåºåˆ—ï¼ˆ20bpï¼‰</li>
                        <li>å¦‚æœåºåˆ—ä¸æ˜¯ä»¥Gå¼€å¤´ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ·»åŠ 5'ç«¯G</li>
                        <li>ç‚¹å‡»"è®¾è®¡å¼•ç‰©"æŒ‰é’®ç”Ÿæˆæ­£å‘å’Œåå‘å¼•ç‰©</li>
                        <li>å¼•ç‰©é€‚ç”¨äºT4é™åˆ¶æ€§é…¶åˆ‡å…‹éš†æ–¹æ³•ï¼ˆBbsI-Esp3Iï¼‰</li>
                    </ul>
                </div>
                
                <div class="input-section">
                    <div class="input-group">
                        <label for="gRNA1">gRNA1 åºåˆ— (æ­£ä¹‰é“¾)</label>
                        <input type="text" id="gRNA1" value="AGCACGCCGAGCCCCAGTAT" 
                               placeholder="ä¾‹å¦‚: AGCACGCCGAGCCCCAGTAT">
                        <div class="seq-info">
                            <span id="gRNA1-length" class="info-badge">é•¿åº¦: 20 bp</span>
                            <span id="gRNA1-gc" class="info-badge">GCå«é‡: è®¡ç®—ä¸­...</span>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="gRNA2">gRNA2 åºåˆ— (æ­£ä¹‰é“¾)</label>
                        <input type="text" id="gRNA2" value="AGTTTATACCGTGCGTTGAA" 
                               placeholder="ä¾‹å¦‚: AGTTTATACCGTGCGTTGAA">
                        <div class="seq-info">
                            <span id="gRNA2-length" class="info-badge">é•¿åº¦: 20 bp</span>
                            <span id="gRNA2-gc" class="info-badge">GCå«é‡: è®¡ç®—ä¸­...</span>
                        </div>
                    </div>
                </div>
                
                <button class="design-btn full-width" onclick="designPrimers()">ğŸ¯ è®¾è®¡å¼•ç‰©</button>
                
                <div id="single-result-section" class="result-section" style="display: none;">
                    <div class="success-msg">âœ… å¼•ç‰©è®¾è®¡å®Œæˆï¼</div>
                    
                    <div class="primers-grid">
                        <div class="primer-card">
                            <div class="primer-title forward">
                                <span class="icon">ğŸ”·</span>
                                <h3>æ­£å‘å¼•ç‰© (Forward Primer)</h3>
                            </div>
                            <div class="sequence-box" id="forward-primer"></div>
                            <div class="properties">
                                <div class="property" id="forward-length"></div>
                                <div class="property" id="forward-gc"></div>
                                <div class="property highlight" id="forward-tm"></div>
                            </div>
                        </div>
                        
                        <div class="primer-card">
                            <div class="primer-title reverse">
                                <span class="icon">ğŸ”¶</span>
                                <h3>åå‘å¼•ç‰© (Reverse Primer)</h3>
                            </div>
                            <div class="sequence-box" id="reverse-primer"></div>
                            <div class="properties">
                                <div class="property" id="reverse-length"></div>
                                <div class="property" id="reverse-gc"></div>
                                <div class="property highlight" id="reverse-tm"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button class="design-btn" onclick="copyAllPrimers()">
                            ğŸ“‹ å¤åˆ¶æ‰€æœ‰å¼•ç‰©
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- æ‰¹é‡è®¾è®¡é€‰é¡¹å¡ -->
            <div id="tab-batch" class="tab-content">
                <div class="instructions">
                    <h3>æ‰¹é‡è®¾è®¡è¯´æ˜ï¼š</h3>
                    <ul>
                        <li>æ¯è¡Œè¾“å…¥ä¸€å¯¹gRNAåºåˆ—ï¼Œç”¨é€—å·ã€åˆ¶è¡¨ç¬¦æˆ–ç©ºæ ¼åˆ†éš”</li>
                        <li>æ”¯æŒå¤šç§æ ¼å¼ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«åˆ†éš”ç¬¦</li>
                        <li>ç‚¹å‡»"æ‰¹é‡è®¾è®¡"æŒ‰é’®ç”Ÿæˆæ‰€æœ‰å¼•ç‰©å¯¹</li>
                        <li>å¯ä»¥ä½¿ç”¨å³ä¾§çš„"ç”Ÿæˆç¤ºä¾‹"æŒ‰é’®æŸ¥çœ‹æ ¼å¼</li>
                    </ul>
                </div>
                
                <div class="batch-section">
                    <label for="batch-input">æ‰¹é‡è¾“å…¥gRNAåºåˆ—å¯¹</label>
                    <textarea class="batch-input" id="batch-input" 
                        placeholder="æ¯è¡Œä¸€å¯¹gRNAåºåˆ—ï¼Œä¾‹å¦‚ï¼š
AGCACGCCGAGCCCCAGTAT,AGTTTATACCGTGCGTTGAA
TAGCTAGCTAGCTAGCTAGC,TCGATCGATCGATCGATCG"></textarea>
                    
                    <div class="button-group">
                        <button class="design-btn" onclick="designBatchPrimers()">ğŸ”„ æ‰¹é‡è®¾è®¡</button>
                        <button class="design-btn" onclick="generateExample()" style="background: #6c757d;">
                            ğŸ“‹ ç”Ÿæˆç¤ºä¾‹
                        </button>
                        <button class="design-btn" onclick="clearBatchInput()" style="background: #dc3545;">
                            ğŸ—‘ï¸ æ¸…ç©ºè¾“å…¥
                        </button>
                    </div>
                    
                    <div id="batch-result-section" class="result-section" style="display: none;">
                        <div class="success-msg">
                            âœ… æ‰¹é‡è®¾è®¡å®Œæˆï¼å…±è®¾è®¡äº† <span id="batch-count">0</span> å¯¹å¼•ç‰©
                        </div>
                        
                        <div id="batch-results-table"></div>
                        
                        <div class="export-options">
                            <button class="export-btn csv" onclick="exportCSV()">ğŸ“¥ å¯¼å‡ºCSV</button>
                            <button class="export-btn fasta" onclick="exportFASTA()">ğŸ§¬ å¯¼å‡ºFASTA</button>
                            <button class="export-btn excel" onclick="exportExcel()">ğŸ“Š å¯¼å‡ºExcel</button>
                            <button class="export-btn" onclick="copyAllResults()">ğŸ“‹ å¤åˆ¶å…¨éƒ¨ç»“æœ</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- æ·»åŠ è´¨ç²’å›¾è°±é€‰é¡¹å¡å†…å®¹ -->
            <div id="tab-plasmid" class="tab-content">
                <div class="instructions">
                    <h3>è´¨ç²’æ„å»ºæµç¨‹</h3>
            
                </div>
                
                <div class="plasmid-section">
                    <!-- æ–¹æ¡ˆ1A: ä½¿ç”¨æœ¬åœ°å›¾ç‰‡ï¼ˆå¦‚æœå›¾ç‰‡åœ¨åŒä¸€ç›®å½•ï¼‰ -->

                    
                    <!-- æˆ–è€…æ–¹æ¡ˆ1B: ä½¿ç”¨åœ¨çº¿å›¾ç‰‡é“¾æ¥ -->
           
                    <div class="plasmid-image">
                        <img src="https://github.com/KeJiiii/dgRNA-primer-design/raw/main/workflow.jpg" alt="è´¨ç²’æ„å»ºå›¾è°±" 
                            style="width: 100%; max-width: 800px;">
                        <p class="image-caption">å›¾1: åŒgRNAå…‹éš†ç¤ºæ„å›¾</p>
                    </div>
                </div>
                
                <!-- æ·»åŠ å›¾ä¾‹è¯´æ˜ -->
                <div class="plasmid-legend" style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h4>è¯´æ˜ï¼š</h4>
                    <ul style="columns: 2; column-gap: 40px;">
                        <li><strong>backbone</strong>ï¼šAAV CAG FlexNLSCherry2x U6gRNA</li>
                        <li><strong>insert template</strong>ï¼šAAV CAG FlexNLSCherry2x U6gRNA</li>

                    </ul>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>ğŸ§¬ chentianlun518@gmail.com </p>
            
    </div>
    
    <script>
        // å›ºå®šåºåˆ—ç»„ä»¶
        const bbsI = "ccgggtcttcgaGAAGACctcacc";
        const binding1 = "gttttagagctagaaatagc";
        const esp3i = "gtttgGAGACGgatcc";
        const binding2 = "tgtggaaaggacgaaacacc";
        
        // å­˜å‚¨æ‰¹é‡ç»“æœ
        let batchResults = [];
        
        // é€‰é¡¹å¡åˆ‡æ¢
        function switchTab(tabName) {
            // æ›´æ–°é€‰é¡¹å¡æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // æ¸…ç©ºç»“æœ
            if (tabName === 'single') {
                clearSingleResults();
            } else {
                clearBatchResults();
            }
        }
        
        // å®æ—¶æ›´æ–°åºåˆ—ä¿¡æ¯
        document.getElementById('gRNA1').addEventListener('input', updateSeqInfo);
        document.getElementById('gRNA2').addEventListener('input', updateSeqInfo);
        
        // åˆå§‹æ›´æ–°
        updateSeqInfo();
        
        function updateSeqInfo() {
            const gRNA1 = document.getElementById('gRNA1').value.toUpperCase();
            const gRNA2 = document.getElementById('gRNA2').value.toUpperCase();
            
            // æ›´æ–°gRNA1ä¿¡æ¯
            document.getElementById('gRNA1-length').textContent = `é•¿åº¦: ${gRNA1.length} bp`;
            document.getElementById('gRNA1-gc').textContent = `GCå«é‡: ${calculateGC(gRNA1)}%`;
            
            // æ›´æ–°gRNA2ä¿¡æ¯
            document.getElementById('gRNA2-length').textContent = `é•¿åº¦: ${gRNA2.length} bp`;
            document.getElementById('gRNA2-gc').textContent = `GCå«é‡: ${calculateGC(gRNA2)}%`;
            
            // éªŒè¯åºåˆ—
            validateSequence(gRNA1, 'gRNA1');
            validateSequence(gRNA2, 'gRNA2');
        }
        
        function calculateGC(sequence) {
            if (!sequence) return 0;
            const gcCount = (sequence.match(/[GC]/gi) || []).length;
            return ((gcCount / sequence.length) * 100).toFixed(1);
        }
        
        function validateSequence(seq, id) {
            const badge = document.getElementById(`${id}-gc`);
            if (!/^[ATCG]*$/i.test(seq)) {
                badge.classList.add('warning');
                badge.textContent += ' (å«éæ ‡å‡†ç¢±åŸº)';
            } else {
                badge.classList.remove('warning');
            }
        }
        
        function getReverseComplement(seq) {
            const complement = {
                'A': 'T', 'T': 'A', 'C': 'G', 'G': 'C',
                'a': 't', 't': 'a', 'c': 'g', 'g': 'c'
            };
            return seq.split('').reverse().map(base => complement[base] || base).join('');
        }
        
        function calculateTm(seq) {
            // ç®€åŒ–çš„Tmè®¡ç®—å…¬å¼
            const gc = parseFloat(calculateGC(seq));
            return (gc * 0.41) + 20;
        }
        
        // å•å¯¹è®¾è®¡å‡½æ•°
        function designPrimers() {
            let gRNA1 = document.getElementById('gRNA1').value;
            let gRNA2 = document.getElementById('gRNA2').value;
            
            if (!gRNA1 || !gRNA2) {
                alert('è¯·è¾“å…¥gRNAåºåˆ—ï¼');
                return;
            }
            
            // æ·»åŠ 5'ç«¯Gï¼ˆå¦‚æœä¸æ˜¯Gå¼€å¤´ï¼‰
            const g1_prefix = gRNA1.match(/^[Gg]/) ? "" : "G";
            const g2_prefix = gRNA2.match(/^[Gg]/) ? "" : "G";
            
            // æ„å»ºæ­£å‘å¼•ç‰©
            const F_primer = bbsI + g1_prefix + gRNA1 + binding1;
            
            // æ„å»ºåå‘å¼•ç‰©ï¼ˆéœ€è¦åå‘äº’è¡¥ï¼‰
            const R_template = binding2 + g2_prefix + gRNA2 + esp3i;
            const R_primer = getReverseComplement(R_template);
            
            // æ˜¾ç¤ºç»“æœ
            document.getElementById('forward-primer').textContent = F_primer;
            document.getElementById('reverse-primer').textContent = R_primer;
            
            // æ˜¾ç¤ºå¼•ç‰©ä¿¡æ¯
            document.getElementById('forward-length').textContent = `é•¿åº¦: ${F_primer.length} bp`;
            document.getElementById('forward-gc').textContent = `GC: ${calculateGC(F_primer)}%`;
            document.getElementById('forward-tm').textContent = `Tm: ~${calculateTm(F_primer).toFixed(1)}Â°C`;
            
            document.getElementById('reverse-length').textContent = `é•¿åº¦: ${R_primer.length} bp`;
            document.getElementById('reverse-gc').textContent = `GC: ${calculateGC(R_primer)}%`;
            document.getElementById('reverse-tm').textContent = `Tm: ~${calculateTm(R_primer).toFixed(1)}Â°C`;
            
            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            document.getElementById('single-result-section').style.display = 'block';
            
            // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            document.getElementById('single-result-section').scrollIntoView({ behavior: 'smooth' });
        }
        
        // æ‰¹é‡è®¾è®¡å‡½æ•°
        function designBatchPrimers() {
            const batchInput = document.getElementById('batch-input').value.trim();
            if (!batchInput) {
                alert('è¯·è¾“å…¥æ‰¹é‡åºåˆ—ï¼');
                return;
            }
            
            const lines = batchInput.split('\n').filter(line => line.trim());
            batchResults = [];
            
            lines.forEach((line, index) => {
                const parts = line.trim().split(/[\t, ]+/).filter(part => part);
                
                if (parts.length >= 2) {
                    const gRNA1 = parts[0];
                    const gRNA2 = parts[1];
                    
                    try {
                        // æ·»åŠ 5'ç«¯Gï¼ˆå¦‚æœä¸æ˜¯Gå¼€å¤´ï¼‰
                        const g1_prefix = gRNA1.match(/^[Gg]/) ? "" : "G";
                        const g2_prefix = gRNA2.match(/^[Gg]/) ? "" : "G";
                        
                        // æ„å»ºæ­£å‘å¼•ç‰©
                        const F_primer = bbsI + g1_prefix + gRNA1 + binding1;
                        
                        // æ„å»ºåå‘å¼•ç‰©ï¼ˆéœ€è¦åå‘äº’è¡¥ï¼‰
                        const R_template = binding2 + g2_prefix + gRNA2 + esp3i;
                        const R_primer = getReverseComplement(R_template);
                        
                        batchResults.push({
                            id: `Pair_${index + 1}`,
                            gRNA1: gRNA1,
                            gRNA2: gRNA2,
                            forward: F_primer,
                            reverse: R_primer,
                            f_length: F_primer.length,
                            r_length: R_primer.length,
                            f_gc: calculateGC(F_primer),
                            r_gc: calculateGC(R_primer),
                            f_tm: calculateTm(F_primer).toFixed(1),
                            r_tm: calculateTm(R_primer).toFixed(1)
                        });
                    } catch (error) {
                        console.error(`ç¬¬${index + 1}è¡Œå¤„ç†é”™è¯¯:`, error);
                    }
                }
            });
            
            if (batchResults.length > 0) {
                displayBatchResults();
                document.getElementById('batch-count').textContent = batchResults.length;
                document.getElementById('batch-result-section').style.display = 'block';
                document.getElementById('batch-result-section').scrollIntoView({ behavior: 'smooth' });
            } else {
                alert('æœªæ‰¾åˆ°æœ‰æ•ˆçš„gRNAåºåˆ—å¯¹ï¼è¯·æ£€æŸ¥è¾“å…¥æ ¼å¼ã€‚');
            }
        }
        
        function displayBatchResults() {
            const table = document.createElement('table');
            table.className = 'results-table';
            
            // è¡¨å¤´
            const thead = table.createTHead();
            const headerRow = thead.insertRow();
            const headers = ['åºå·', 'gRNA1', 'gRNA2', 'æ­£å‘å¼•ç‰©', 'åå‘å¼•ç‰©', 'é•¿åº¦', 'GC%', 'Tm'];
            
            headers.forEach(headerText => {
                const th = document.createElement('th');
                th.textContent = headerText;
                headerRow.appendChild(th);
            });
            
            // è¡¨æ ¼å†…å®¹
            const tbody = table.createTBody();
            
            batchResults.forEach((result, index) => {
                const row = tbody.insertRow();
                
                // åºå·
                const cell1 = row.insertCell();
                cell1.textContent = result.id;
                
                // gRNA1
                const cell2 = row.insertCell();
                cell2.textContent = result.gRNA1;
                cell2.className = 'seq-cell';
                
                // gRNA2
                const cell3 = row.insertCell();
                cell3.textContent = result.gRNA2;
                cell3.className = 'seq-cell';
                
                // æ­£å‘å¼•ç‰©
                const cell4 = row.insertCell();
                cell4.textContent = result.forward;
                cell4.className = 'seq-cell';
                
                // åå‘å¼•ç‰©
                const cell5 = row.insertCell();
                cell5.textContent = result.reverse;
                cell5.className = 'seq-cell';
                
                // é•¿åº¦
                const cell6 = row.insertCell();
                cell6.innerHTML = `<b>F:</b> ${result.f_length} bp<br><b>R:</b> ${result.r_length} bp`;
                
                // GCå«é‡
                const cell7 = row.insertCell();
                cell7.innerHTML = `<b>F:</b> ${result.f_gc}%<br><b>R:</b> ${result.r_gc}%`;
                
                // Tmå€¼
                const cell8 = row.insertCell();
                cell8.innerHTML = `<b>F:</b> ${result.f_tm}Â°C<br><b>R:</b> ${result.r_tm}Â°C`;
            });
            
            document.getElementById('batch-results-table').innerHTML = '';
            document.getElementById('batch-results-table').appendChild(table);
        }
        
        // ç”Ÿæˆç¤ºä¾‹
        function generateExample() {
            const example = `AGCACGCCGAGCCCCAGTAT,AGTTTATACCGTGCGTTGAA
TAGCTAGCTAGCTAGCTAGC,TCGATCGATCGATCGATCG
AAACCCGGGTTTAAACCCGG,TTTGGGCCCAAATTTGGGCC
ATCGATCGATCGATCGATCG,TAGCTAGCTAGCTAGCTAGC`;
            
            document.getElementById('batch-input').value = example;
        }
        
        // æ¸…ç©ºè¾“å…¥
        function clearBatchInput() {
            document.getElementById('batch-input').value = '';
        }
        
        // æ¸…ç©ºå•å¯¹ç»“æœ
        function clearSingleResults() {
            document.getElementById('single-result-section').style.display = 'none';
        }
        
        // æ¸…ç©ºæ‰¹é‡ç»“æœ
        function clearBatchResults() {
            document.getElementById('batch-result-section').style.display = 'none';
            batchResults = [];
        }
        
        // å¯¼å‡ºåŠŸèƒ½
        function exportCSV() {
            if (batchResults.length === 0) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®ï¼');
                return;
            }
            
            const headers = ['ID', 'gRNA1', 'gRNA2', 'Forward_Primer', 'Reverse_Primer', 
                           'F_Length', 'R_Length', 'F_GC%', 'R_GC%', 'F_Tm', 'R_Tm'];
            
            const csvRows = [
                headers.join(','),
                ...batchResults.map(row => [
                    row.id,
                    `"${row.gRNA1}"`,
                    `"${row.gRNA2}"`,
                    `"${row.forward}"`,
                    `"${row.reverse}"`,
                    row.f_length,
                    row.r_length,
                    row.f_gc,
                    row.r_gc,
                    row.f_tm,
                    row.r_tm
                ].join(','))
            ];
            
            const csvContent = csvRows.join('\n');
            downloadFile(csvContent, 'gRNA_primers.csv', 'text/csv');
        }
        
        function exportFASTA() {
            if (batchResults.length === 0) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®ï¼');
                return;
            }
            
            let fastaContent = '';
            batchResults.forEach(row => {
                fastaContent += `>${row.id}_F\n${row.forward}\n`;
                fastaContent += `>${row.id}_R\n${row.reverse}\n`;
            });
            
            downloadFile(fastaContent, 'gRNA_primers.fasta', 'text/plain');
        }
        
        function exportExcel() {
            if (batchResults.length === 0) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®ï¼');
                return;
            }
            
            // åˆ›å»ºExcelæ ¼å¼çš„CSV
            const headers = ['ID', 'gRNA1', 'gRNA2', 'Forward Primer', 'Reverse Primer', 
                           'F Length', 'R Length', 'F GC%', 'R GC%', 'F Tm', 'R Tm'];
            
            const csvRows = [
                headers.join('\t'),
                ...batchResults.map(row => [
                    row.id,
                    row.gRNA1,
                    row.gRNA2,
                    row.forward,
                    row.reverse,
                    row.f_length,
                    row.r_length,
                    row.f_gc,
                    row.r_gc,
                    row.f_tm,
                    row.r_tm
                ].join('\t'))
            ];
            
            const excelContent = csvRows.join('\n');
            downloadFile(excelContent, 'gRNA_primers.xls', 'application/vnd.ms-excel');
        }
        
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // å¤åˆ¶åŠŸèƒ½
        function copyAllPrimers() {
            const forward = document.getElementById('forward-primer').textContent;
            const reverse = document.getElementById('reverse-primer').textContent;
            
            const text = `æ­£å‘å¼•ç‰©: ${forward}\nåå‘å¼•ç‰©: ${reverse}\n\nç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString()}`;
            
            copyToClipboard(text, 'å•å¯¹å¼•ç‰©');
        }
        
        function copyAllResults() {
            if (batchResults.length === 0) {
                alert('æ²¡æœ‰å¯å¤åˆ¶çš„æ•°æ®ï¼');
                return;
            }
            
            let text = `æ‰¹é‡gRNAå¼•ç‰©è®¾è®¡ç»“æœ (å…±${batchResults.length}å¯¹)\n\n`;
            
            batchResults.forEach(row => {
                text += `${row.id}:\n`;
                text += `  gRNA1: ${row.gRNA1}\n`;
                text += `  gRNA2: ${row.gRNA2}\n`;
                text += `  æ­£å‘: ${row.forward}\n`;
                text += `  åå‘: ${row.reverse}\n\n`;
            });
            
            text += `ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString()}`;
            
            copyToClipboard(text, 'æ‰¹é‡ç»“æœ');
        }
        
        function copyToClipboard(text, label) {
            navigator.clipboard.writeText(text).then(() => {
                alert(`âœ… ${label}å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼`);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥: ', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¹¶å¤åˆ¶');
            });
        }
        
        // æ·»åŠ å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                const activeTab = document.querySelector('.tab.active');
                if (activeTab.textContent.includes('å•å¯¹')) {
                    designPrimers();
                } else {
                    designBatchPrimers();
                }
            }
        });
    </script>
</body>
</html>
